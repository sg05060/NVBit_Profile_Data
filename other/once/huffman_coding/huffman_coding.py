import heapq
import math
from collections import defaultdict

def huffman_code(symbols, probabilities):
    """Huffman coding algorithm to calculate the optimal prefix code."""
    # Create a priority queue to store nodes of the Huffman tree.
    heap = [[probability, [symbol, ""]] for symbol, probability in zip(symbols, probabilities)]
    print("heap",heap)
    heapq.heapify(heap)
    
    # Combine nodes until there is only one node left in the heap.
    while len(heap) > 1:
        # Get the two nodes with the lowest probabilities.
        low_prob_node_1 = heapq.heappop(heap)
        low_prob_node_2 = heapq.heappop(heap)
        
        # Combine the nodes and add the result to the heap.
        for pair in low_prob_node_1[1:]:
            pair[1] = '0' + pair[1]
        for pair in low_prob_node_2[1:]:
            pair[1] = '1' + pair[1]
        heapq.heappush(heap, [low_prob_node_1[0] + low_prob_node_2[0]] + low_prob_node_1[1:] + low_prob_node_2[1:])
    
    # Return the Huffman code as a dictionary.
    huffman_dict = dict(heapq.heappop(heap)[1:])
    print("huffman_dict",huffman_dict)
    return huffman_dict

def main():
    # Define the entropy values and corresponding symbols.
    resnet_probability_values =[0.000000,0.000000,0.019140,0.094730,0.143320,0.118860,0.074690,0.040490,0.020740,0.010610,0.005420,0.002860,0.001500,0.000820,0.000480,0.000990,0.000460,0.000800,0.001500,0.002810,0.005400,0.010350,0.020030,0.037500,0.065100,0.096310,0.112260,0.081100,0.020930,0.000000,0.000000]
    
    resnet_probability_values =[1.29397E-06,2.70557E-06,7.05802E-06,2.42325E-05,1.20378E-05,1.92527E-05,3.04671E-05,4.64653E-05,7.41876E-05,0.000135161,0.000261656,0.000524764,0.000466143,9.41069E-07,0.000691333,0.00102306,0.00154798,0.002293581,0.003445724,0.005186114,0.00777421,0.011572757,0.017454713,0.02627994,0.039261399,0.026287978,9.53617E-05,0.032013638,0.038561792,0.045926716,0.054327169,0.064075546,0.074522784,0.040679041,0.020683442,0.010574832,0.005423577,0.002837049,0.00148634,0.00081524,0.000478181,0.003561868,0.000460104,0.000805398,0.001488418,0.002795994,0.005388443,0.010347132,0.019963132,0.037442783,0.064945603,0.052869178,0.043296624,0.035874727,0.02998536,0.025147795,0.020971958,0.032197892,0.022385287,0.015598023,0.010880914,0.007622933,0.005369034,0.003765217,0.002695261,0.001920094,0.001376627,0.000993416,0.000724702,0.000915621,0.000501629,0.000290124,0.00016904,0.000107517,6.76001E-05,4.26226E-05,2.87026E-05,5.31312E-05,1.52139E-05,5.45036E-06,3.56822E-06]
    
    mobilenet_v2_entropy_values = [0.14298295,0.134595302,0.134479588,0.125969767,0.124890993,0.117908756,0.115924981,0.11325494,0.112919132,0.112877122,0.112751056,0.112077599,0.111106225,0.110470632,0.109748268,0.109620568,0.109364959,0.107825624,0.107653975,0.10614678,0.10606037,0.106017149,0.104325464,0.103889747,0.102884532,0.101874998,0.101566881,0.100418869,0.099354112,0.09779249,0.097568538,0.096895349,0.096220178,0.095090413,0.093909445,0.093316641,0.092493229,0.090791064,0.089540636,0.088096137,0.087628127,0.085887659,0.085840421,0.084275811,0.078045932,0.076964527,0.070910493,0.068970089,0.067372449,0.066594529,0.063502857,0.060519193,0.05693703,0.05249179,0.049937441,0.04540888,0.043987724,0.038528978,0.038528978,0.038528978,0.037908861,0.033225168,0.032902275,0.028352845,0.028150812,0.023745,0.023463081,0.022683448,0.022398328,0.019864183,0.019790683,0.016871096,0.016565359,0.014308947,0.013991804,0.012707296,0.012707296,0.01205482,0.0116433,0.010135959,0.009795032,0.00919268,0.008141629,0.007874902,0.007426524,0.00724577,0.006973063,0.006514131,0.006514131,0.006235962,0.005482892,0.005195874,0.004416453,0.004018125,0.00391754,0.003613188,0.002779798,0.002565638,0.00212877,0.002017542,0.00179232,0.001678196,0.001209574,0.001209574,0.001088771,0.001088771,0.00096616,0.000841481,0.000841481,0.000714386,0.000584386,0.00045074,0.00045074,0.000312193,0.000312193,0.000312193,0.000166096,0.000166096,0.000166096,0.000166096,0.000166096,0.000166096,0.000166096,0.000166096,0,0,0,0,0]
    mobilenet_v2_probability_values = [0.02761000 ,0.02540000 ,0.02537000 ,0.02320000 ,0.02293000 ,0.02121000 ,0.02073000 ,0.02009000 ,0.02001000 ,0.02000000 ,0.01997000 ,0.01981000 ,0.01958000 ,0.01943000 ,0.01926000 ,0.01923000 ,0.01917000 ,0.01881000 ,0.01877000 ,0.01842000 ,0.01840000 ,0.01839000 ,0.01800000 ,0.01790000 ,0.01767000 ,0.01744000 ,0.01737000 ,0.01711000 ,0.01687000 ,0.01652000 ,0.01647000 ,0.01632000 ,0.01617000 ,0.01592000 ,0.01566000 ,0.01553000 ,0.01535000 ,0.01498000 ,0.01471000 ,0.01440000 ,0.01430000 ,0.01393000 ,0.01392000 ,0.01359000 ,0.01230000 ,0.01208000 ,0.01087000 ,0.01049000 ,0.01018000 ,0.01003000 ,0.00944000 ,0.00888000 ,0.00822000 ,0.00742000 ,0.00697000 ,0.00619000 ,0.00595000 ,0.00505000 ,0.00505000 ,0.00505000 ,0.00495000 ,0.00421000 ,0.00416000 ,0.00347000 ,0.00344000 ,0.00280000 ,0.00276000 ,0.00265000 ,0.00261000 ,0.00226000 ,0.00225000 ,0.00186000 ,0.00182000 ,0.00153000 ,0.00149000 ,0.00133000 ,0.00133000 ,0.00125000 ,0.00120000 ,0.00102000 ,0.00098000 ,0.00091000 ,0.00079000 ,0.00076000 ,0.00071000 ,0.00069000 ,0.00066000 ,0.00061000 ,0.00061000 ,0.00058000 ,0.00050000 ,0.00047000 ,0.00039000 ,0.00035000 ,0.00034000 ,0.00031000 ,0.00023000 ,0.00021000 ,0.00017000 ,0.00016000 ,0.00014000 ,0.00013000 ,0.00009000 ,0.00009000 ,0.00008000 ,0.00008000 ,0.00007000 ,0.00006000 ,0.00006000 ,0.00005000 ,0.00004000 ,0.00003000 ,0.00003000 ,0.00002000 ,0.00002000 ,0.00002000 ,0.00001000 ,0.00001000 ,0.00001000 ,0.00001000 ,0.00001000 ,0.00001000 ,0.00001000 ,0.00001000]
    efficientnet_b2_probability_values =[9.999999747378752e-06,0.0,9.999999747378752e-06,9.999999747378752e-06,2.9999999242136255e-05,7.000000186963007e-05,0.00019999999494757503,0.0005499999970197678,0.0005699999746866524,0.0,0.0009599999757483602,0.001560000004246831,0.0024399999529123306,0.0037700000684708357,0.00559999980032444,0.008229999803006649,0.011669999919831753,0.007430000230669975,9.999999747378752e-06,0.00875999964773655,0.01013999991118908,0.011749999597668648,0.01372000016272068,0.01582000032067299,0.01834999956190586,0.021409999579191208,0.02507000043988228,0.029179999604821205,0.034129999577999115,0.04010999947786331,0.022579999640583992,7.999999797903001e-05,0.02449999935925007,0.026440000161528587,0.028669999912381172,0.030789999291300774,0.03322000056505203,0.0364999994635582,0.02053000032901764,0.01092000026255846,0.005669999867677689,0.002839999971911311,0.0014299999456852674,0.0007200000109151006,0.0003499999875202775,0.00016999999934341758,0.0001900000061141327,0.00016999999934341758,0.0003600000054575503,0.0007099999929778278,0.0014100000262260437,0.0028299998957663774,0.005590000189840794,0.010889999568462372,0.02022000029683113,0.03604000061750412,0.03262000158429146,0.030009999871253967,0.027580000460147858,0.025210000574588776,0.023080000653862953,0.02112000063061714,0.036959998309612274,0.030700000002980232,0.025669999420642853,0.021570000797510147,0.018209999427199364,0.015540000051259995,0.013269999995827675,0.011409999802708626,0.009850000031292439,0.008580000139772892,0.007449999917298555,0.006560000125318766,0.01075000036507845,0.00824000034481287,0.006200000178068876,0.004629999864846468,0.003289999905973673,0.0022700000554323196,0.0014700000174343586,0.0009399999980814755,0.0009200000204145908,0.00031999999191612005,0.00011000000085914508,3.9999998989515007e-05,1.9999999494757503e-05,9.999999747378752e-06,9.999999747378752e-06,9.999999747378752e-06]
    
    vgg19_probability_values =[0.0,0.0,0.0,4.999999873689376e-05,5.999999848427251e-05,0.00013000000035390258,0.0,0.0002800000074785203,0.0005799999926239252,0.0011500000255182385,0.0022299999836832285,0.004129999782890081,0.0073899999260902405,0.005520000122487545,9.999999747378752e-06,0.007199999876320362,0.009270000271499157,0.01181000005453825,0.01484999991953373,0.018459999933838844,0.022670000791549683,0.02744000032544136,0.03272999823093414,0.03846000134944916,0.04447000101208687,0.050370000302791595,0.02718999981880188,9.999999747378752e-05,0.028529999777674675,0.029650000855326653,0.03053000010550022,0.031199999153614044,0.03156000003218651,0.03164999932050705,0.015890000388026237,0.007840000092983246,0.003909999970346689,0.0019499999471008778,0.0009800000116229057,0.0004900000058114529,0.00023999999393709004,0.00011999999696854502,0.00011999999696854502,0.00011999999696854502,0.00023999999393709004,0.0004900000058114529,0.0009699999936856329,0.0019399999873712659,0.0038900000508874655,0.007739999797195196,0.015350000001490116,0.030090000480413437,0.029090000316500664,0.02792000025510788,0.026660000905394554,0.025270000100135803,0.02387000061571598,0.022430000826716423,0.04056999832391739,0.03511999920010567,0.03003999963402748,0.02538999915122986,0.02126000076532364,0.01761999912559986,0.01448999997228384,0.011850000359117985,0.009580000303685665,0.00773000018671155,0.0061900001019239426,0.00494999997317791,0.007019999902695417,0.004360000137239695,0.00267999991774559,0.0016199999954551458,0.0009500000160187483,0.0005600000149570405,0.0003100000030826777,0.00016999999934341758,0.00018000000272877514,9.999999747378752e-06,0.0,0.0]
    
    
    
    #entropy_values = [0.4, 0.25, 0.2, 0.1, 0.05]
    cnt = len(efficientnet_b2_probability_values)
    symbols = [ f"{i}" for i in range(cnt)]
    print(symbols)


    # probabilities = []
    # # Calculate the probabilities from the entropy values.
    # for p in entropy_values :
    #     if p != 0 :
    #         probabilities.append(-p * math.log2(p))
    #     else :
    #         probabilities.append(0)
    # total_prob = sum(probabilities)
    # print("error:",total_prob)
    # probabilities = [p/total_prob for p in probabilities]
    
    # Calculate the Huffman code and the number of bits required for each symbol.
    huffman_dict = huffman_code(symbols, efficientnet_b2_probability_values)
    symbol_bits = {symbol: len(huffman_dict[symbol]) for symbol in symbols}
    print("symbol_bits",symbol_bits)
    
    bit_total=0
    code_length = 0
    
    # Print the results.
    print("Symbol\tBits")
    for symbol, bits in symbol_bits.items():
        print(symbol, "\t", bits)
        bit_total += bits
    print("bit_total",bit_total)
    for symbol, probability in zip(symbols, efficientnet_b2_probability_values):
        code_length += symbol_bits[symbol]*probability
    print(code_length)
if __name__ == "__main__":
    main()